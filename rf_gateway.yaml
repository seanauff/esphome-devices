substitutions:
  name: rf_gateway

esphome:
  name: ${name}
  platform: ESP32
  board: esp32dev

packages:
  wifi: !include common/wifi.yaml
  web_server: !include common/web_server.yaml
  device_base: !include common/device_base.yaml

light:
  # Status LED
  - platform: status_led
    id: onboard_led
    pin: GPIO2

remote_transmitter:
  - pin: GPIO15
    carrier_duty_percent: 100% # RF uses a 100% carrier signal
    id: tx_315
  - pin: GPIO13
    carrier_duty_percent: 100% # RF uses a 100% carrier signal
    id: tx_433
  - pin: GPIO12
    carrier_duty_percent: 100% # RF uses a 100% carrier signal
    id: tx_304

button:
  - platform: template
    name: "Test 433 TX"
    disabled_by_default: True
    on_press:
      - remote_transmitter.transmit_raw:
          transmitter_id: tx_433
          repeat:
            times: 10
            wait_time: 6ms
          code: [500,-200,500,-200,500,-200,500,-200,500,-200,500,-200,500,-200,500,-200,500,-200,500,-200]

switch:
  # Defiant RF Outlet #1
  - platform: template
    name: "Defiant Outlet 1"
    optimistic: true
    assumed_state: true
    turn_on_action:
      - light.turn_on: onboard_led
      - remote_transmitter.transmit_raw:
          transmitter_id: tx_315
          repeat:
            times: 10
            wait_time: 6ms
          code: [609,-224,224,-609,609,-224,224,-609,609,-224,609,-224,609,-224,224,-609,224,-609,609,-224,609,-224,224,-609,224,-609,609,-224,609,-224,224,-609,224,-609,609,-224,609,-224,609,-224,224,-609,224,-609,224,-609,609,-224,224]
      - light.turn_off: onboard_led
    turn_off_action:
      - light.turn_on: onboard_led
      - remote_transmitter.transmit_raw:
          transmitter_id: tx_315
          repeat:
            times: 10
            wait_time: 6ms
          code: [609,-224,224,-609,609,-224,224,-609,609,-224,609,-224,609,-224,224,-609,224,-609,609,-224,609,-224,224,-609,224,-609,609,-224,609,-224,224,-609,224,-609,609,-224,609,-224,609,-224,609,-224,224,-609,224,-609,224,-609,224]
      - light.turn_off: onboard_led
  
  # Defiant RF Outlet #2
  - platform: template
    name: "Defiant Outlet 2"
    optimistic: true
    assumed_state: true
    turn_on_action:
      - light.turn_on: onboard_led
      - remote_transmitter.transmit_raw:
          transmitter_id: tx_315
          repeat:
            times: 10
            wait_time: 6ms
          code: [609,-224,224,-609,609,-224,224,-609,609,-224,609,-224,609,-224,224,-609,224,-609,609,-224,609,-224,224,-609,224,-609,609,-224,609,-224,224,-609,224,-609,609,-224,609,-224,609,-224,224,-609,224,-609,609,-224,224,-609,224]
      - light.turn_off: onboard_led
    turn_off_action:
      - light.turn_on: onboard_led
      - remote_transmitter.transmit_raw:
          transmitter_id: tx_315
          repeat:
            times: 10
            wait_time: 6ms
          code: [609,-224,224,-609,609,-224,224,-609,609,-224,609,-224,609,-224,224,-609,224,-609,609,-224,609,-224,224,-609,224,-609,609,-224,609,-224,224,-609,224,-609,609,-224,609,-224,609,-224,224,-609,609,-224,609,-224,224,-609,224]
      - light.turn_off: onboard_led
  
  # Defiant RF Outlet #3
  - platform: template
    name: "Defiant Outlet 3"
    optimistic: true
    assumed_state: true
    turn_on_action:
      - light.turn_on: onboard_led
      - remote_transmitter.transmit_raw:
          transmitter_id: tx_315
          repeat:
            times: 10
            wait_time: 6ms
          code: [609,-224,224,-609,609,-224,224,-609,609,-224,609,-224,609,-224,224,-609,224,-609,609,-224,609,-224,224,-609,224,-609,609,-224,609,-224,224,-609,224,-609,609,-224,609,-224,609,-224,224,-609,609,-224,224,-609,224,-609,224]
      - light.turn_off: onboard_led
    turn_off_action:
      - light.turn_on: onboard_led
      - remote_transmitter.transmit_raw:
          transmitter_id: tx_315
          repeat:
            times: 10
            wait_time: 6ms
          code: [609,-224,224,-609,609,-224,224,-609,609,-224,609,-224,609,-224,224,-609,224,-609,609,-224,609,-224,224,-609,224,-609,609,-224,609,-224,224,-609,224,-609,609,-224,609,-224,609,-224,224,-609,609,-224,224,-609,609,-224,224]
      - light.turn_off: onboard_led

  # Emerson SW405 Light ?, ?, ?, ?, ? (Nursery)
  - platform: template
    name: "Nursery Light"
    optimistic: true
    assumed_state: true
    turn_on_action:
      - remote_transmitter.transmit_raw:
          transmitter_id: tx_304
          repeat:
            times: 4
            wait_time: 10ms
          code: [324,-328,628,-648,312,-340,620,-652,308,-656,308,-332,628,-648,312,-648,308,-652,308,-652,308,-648,308,-332,628]
    turn_off_action:
      - remote_transmitter.transmit_raw:
          transmitter_id: tx_304
          repeat:
            times: 4
            wait_time: 10ms
          code: [324,-328,628,-648,312,-340,620,-652,308,-656,308,-332,628,-648,312,-648,308,-652,308,-652,308,-648,308,-332,628]

fan:
  # Fanimation RH787T UP,DOWN,DOWN,UP (Living Room)
  - platform: template
    name: "Living Room Fan"
    id: living_room_fan
    has_direction: True
    has_oscillating: False
    speed_count: 6
    on_turn_on:
      # set the last used speed
      - fan.turn_on:
          id: living_room_fan
          speed: !lambda return id(living_room_fan).speed;
    on_turn_off:
      # send the stop command
      - remote_transmitter.transmit_raw:
         transmitter_id: tx_304
         repeat:
           times: 15
           wait_time: 11.6ms
         code: [265,-390,600,-388,600,-725,265,-663,265,-376,600,-474,600,-718,265,-721,265,-728,265,-731,265,-393,600,-714,265]
    on_direction_set:
      # send same code (reverse) either way, since the code just toggles
      - remote_transmitter.transmit_raw:
          transmitter_id: tx_304
          repeat:
            times: 15
            wait_time: 11.6ms
          code: [265,-390,600,-388,600,-725,265,-663,265,-376,600,-474,600,-718,265,-721,265,-728,265,-391,600,-721,265,-726,265]
    on_speed_set:
      # send the code according to desired speed
      - remote_transmitter.transmit_raw:
          transmitter_id: tx_304
          repeat:
            times: 15
            wait_time: 11.6ms
          code: !lambda |-
            switch (x) {
            case 1: return {265,-390,600,-388,600,-725,265,-663,265,-376,600,-474,600,-718,265,-721,265,-396,600,-728,265,-716,265,-726,265};
            case 2: return {265,-390,600,-388,600,-725,265,-663,265,-376,600,-474,600,-718,265,-721,265,-396,600,-728,265,-393,600,-714,265};
            case 3: return {265,-390,600,-388,600,-725,265,-663,265,-376,600,-474,600,-718,265,-396,600,-718,265,-731,265,-716,265,-726,265};
            case 4: return {265,-390,600,-388,600,-725,265,-663,265,-376,600,-474,600,-718,265,-396,600,-386,600,-728,265,-716,265,-726,265};
            case 5: return {265,-390,600,-388,600,-725,265,-663,265,-376,600,-474,600,-387,600,-717,265,-728,265,-731,265,-393,600,-714,265};
            case 6: return {265,-390,600,-388,600,-725,265,-663,265,-376,600,-474,600,-387,600,-717,265,-728,265,-731,265,-716,265,-726,265};
            default: return {};
            }

  # Fanimation JY1126+TR205E DOWN, DOWN, DOWN, DOWN, UP (Master Bedroom)
  - platform: template
    name: "Master Bedroom Fan"
    id: master_bedroom_fan
    has_direction: True
    has_oscillating: False
    speed_count: 16
    preset_modes:
      - Normal
      - Natural Breeze
      #- Sleep Timer 1 Hr
      #- Sleep Timer 3 Hr
      #- Sleep Timer 6 Hr
      #- Home Away
      #- Safe Exit
    on_turn_on:
      # set the last used speed
      - fan.turn_on:
          id: master_bedroom_fan
          speed: !lambda return id(master_bedroom_fan).speed;
    on_turn_off:
      - remote_transmitter.transmit_raw:
          transmitter_id: tx_304
          repeat:
            times: 10
            wait_time: 10ms
          code: [404,-376,772,-388,764,-388,764,-388,764,-388,760,-392,764,-388,764,-388,764,-388,764,-388,764,-388,764,-772,376,-776,380,-772,380,-772,380,-388,764,-388,764,-388,764,-388,764,-388,764,-388,764,-388,760,-392,764,-388,764]
    on_direction_set:
      - remote_transmitter.transmit_raw:
          transmitter_id: tx_304
          repeat:
            times: 10
            wait_time: 10ms
          code: !lambda |-
            if (x == FanDirection::FORWARD) {
              return {412,-372,784,-364,788,-364,784,-372,784,-372,780,-364,788,-364,788,-368,784,-372,780,-372,780,-368,784,-756,396,-748,404,-752,400,-756,396,-372,780,-372,780,-752,400,-756,396,-372,780,-372,780,-368,784,-756,396,-372,784};
            } else if (x == FanDirection::REVERSE) {
              return {416,-364,784,-368,784,-372,784,-364,784,-368,784,-372,780,-376,780,-372,780,-364,784,-372,780,-372,784,-748,404,-752,396,-756,400,-748,404,-364,788,-364,788,-756,392,-752,404,-364,788,-364,784,-372,784,-748,404,-748,404};
            } else {
              return {};
            }
    on_preset_set:
      - remote_transmitter.transmit_raw:
          transmitter_id: tx_304
          repeat:
            times: 10
            wait_time: 10ms
          code: !lambda |-
            if (x == "Normal") {
              auto call = id(master_bedroom_fan).turn_on();
              call.set_speed(id(master_bedroom_fan).speed);
              call.perform();
              return {};
            } else if (x == "Natural Breeze") {
              return {416,-368,784,-368,784,-364,784,-372,784,-372,780,-364,784,-368,784,-372,784,-368,780,-368,784,-372,780,-752,404,-752,396,-756,396,-752,400,-372,780,-368,784,-372,780,-752,400,-752,400,-756,396,-368,784,-752,400,-364,788};
            } else if (x == "Sleep Timer 1 Hr") {
              return {};
            } else if (x == "Sleep Timer 3 Hr") {
              return {};
            } else if (x == "Sleep Timer 6 Hr") {
              return {};
            } else if (x == "Home Away") {
              return {};
            } else if (x == "Safe Exit") {
              return {};
            } else {
              return {};
            }
    on_speed_set:
      - remote_transmitter.transmit_raw:
          transmitter_id: tx_304
          repeat:
            times: 10
            wait_time: 10ms
          code: !lambda |-
            switch (x) {
            case 1: return {408,-372,780,-376,780,-368,780,-372,780,-376,780,-368,780,-372,780,-376,780,-368,780,-372,780,-376,776,-756,396,-760,392,-752,400,-756,396,-372,780,-376,780,-368,780,-372,780,-376,780,-368,780,-372,780,-376,780,-752,396};
            case 2: return {404,-376,776,-380,772,-380,772,-376,776,-376,780,-376,776,-372,780,-372,780,-376,776,-376,776,-372,780,-760,392,-756,396,-760,392,-764,388,-380,772,-376,776,-376,780,-372,780,-376,772,-376,780,-372,780,-756,396,-756,396};
            case 3: return {408,-372,780,-376,776,-376,776,-372,780,-372,784,-372,780,-376,772,-376,780,-372,780,-376,776,-376,776,-760,392,-760,392,-756,400,-752,396,-372,780,-372,780,-380,776,-372,780,-372,780,-372,780,-752,400,-372,780,-760,392};
            case 4: return {412,-376,772,-376,780,-372,780,-376,772,-376,780,-372,780,-376,776,-380,772,-372,780,-376,776,-380,772,-760,392,-764,388,-760,396,-756,392,-376,780,-372,780,-376,776,-372,780,-372,780,-376,776,-756,392,-764,392,-760,392};
            case 5: return {408,-376,776,-372,780,-372,780,-376,776,-380,772,-372,780,-376,780,-376,776,-372,776,-376,780,-372,780,-756,392,-764,392,-760,392,-756,396,-376,776,-372,780,-372,780,-376,776,-376,776,-760,392,-376,776,-380,772,-760,396};
            case 6: return {408,-376,776,-376,776,-372,780,-376,776,-380,772,-376,776,-376,780,-376,776,-376,776,-372,780,-372,780,-760,392,-756,396,-760,392,-764,388,-380,772,-376,776,-376,776,-376,780,-376,776,-760,392,-372,780,-756,396,-756,392};
            case 7: return {412,-372,780,-376,772,-376,780,-372,780,-376,776,-376,776,-372,780,-376,776,-380,776,-372,776,-376,780,-760,392,-756,396,-760,392,-764,388,-380,772,-380,772,-376,780,-372,780,-376,776,-760,392,-764,388,-376,776,-760,392};
            case 8: return {412,-376,772,-376,780,-372,780,-376,776,-380,772,-376,776,-376,780,-376,776,-372,776,-376,780,-376,776,-756,396,-760,392,-764,392,-756,396,-372,780,-372,780,-376,776,-376,776,-372,780,-764,388,-760,392,-760,392,-764,392};
            case 9: return {408,-372,780,-376,780,-376,776,-372,776,-376,780,-376,776,-376,776,-372,780,-376,776,-380,776,-372,780,-760,392,-760,392,-756,396,-760,392,-376,776,-380,772,-372,784,-372,780,-756,396,-376,776,-372,780,-376,776,-756,396};
            case 10: return {408,-376,776,-376,776,-372,780,-376,776,-376,776,-372,780,-376,776,-380,776,-376,776,-372,780,-372,780,-756,396,-760,392,-764,392,-760,392,-376,776,-372,780,-372,780,-376,780,-756,392,-380,776,-372,780,-760,392,-756,396};
            case 11: return {408,-372,780,-376,776,-376,776,-372,780,-376,780,-376,776,-376,776,-372,780,-376,776,-380,772,-372,780,-764,388,-760,396,-756,396,-760,392,-376,776,-376,776,-376,776,-376,776,-760,392,-380,772,-764,392,-376,776,-756,396};
            case 12: return {408,-376,776,-380,772,-376,780,-372,780,-376,776,-372,780,-372,780,-376,776,-380,772,-376,776,-376,780,-760,392,-756,396,-764,388,-760,396,-372,780,-372,776,-376,780,-376,776,-760,392,-372,780,-764,388,-760,396,-760,388};
            case 13: return {404,-376,780,-376,772,-376,776,-376,780,-376,776,-380,772,-376,776,-376,780,-376,776,-376,772,-380,776,-760,392,-760,392,-760,392,-760,392,-376,780,-376,776,-376,776,-376,776,-764,388,-760,392,-376,776,-376,780,-760,392};
            case 14: return {408,-372,780,-372,780,-376,780,-376,772,-376,780,-376,776,-376,776,-380,772,-372,780,-376,780,-376,772,-760,396,-760,392,-764,388,-760,392,-380,772,-376,776,-380,776,-376,776,-760,392,-764,388,-380,772,-760,392,-764,392};
            case 15: return {408,-372,776,-376,776,-376,780,-376,776,-376,776,-376,776,-376,780,-376,772,-380,776,-372,780,-376,776,-760,392,-760,392,-764,388,-764,392,-376,776,-376,776,-376,776,-380,772,-760,392,-764,388,-764,392,-376,776,-756,396};
            case 16: return {408,-376,776,-380,772,-380,772,-376,776,-376,780,-376,776,-376,776,-376,776,-376,776,-380,776,-376,776,-760,392,-760,392,-760,392,-760,392,-376,780,-376,776,-376,776,-372,780,-764,388,-764,388,-760,392,-760,396,-760,392};
            default: return {};
            }

  # Fanimation JY1126+TR205E UP, DOWN, UP, DOWN, UP (Loft)
  - platform: template
    name: "Loft Fan"
    id: loft_fan
    has_direction: True
    has_oscillating: False
    speed_count: 16
    preset_modes:
      - Normal
      - Natural Breeze
      #- Sleep Timer 1 Hr
      #- Sleep Timer 3 Hr
      #- Sleep Timer 6 Hr
      #- Home Away
      #- Safe Exit
    on_turn_on:
      # set the last used speed
      - fan.turn_on:
          id: loft_fan
          speed: !lambda return id(loft_fan).speed;
    on_turn_off:
      - remote_transmitter.transmit_raw:
          transmitter_id: tx_304
          repeat:
            times: 10
            wait_time: 10ms
          code: [404,-380,780,-388,772,-392,772,-392,772,-392,772,-392,772,-392,772,-392,772,-392,776,-388,776,-388,776,-388,776,-776,388,-388,776,-776,384,-392,772,-392,772,-392,772,-392,772,-392,772,-392,776,-388,772,-392,772,-392,776]
    on_direction_set:
      - remote_transmitter.transmit_raw:
          transmitter_id: tx_304
          repeat:
            times: 10
            wait_time: 10ms
          code: !lambda |-
            if (x == FanDirection::FORWARD) {
              return {408,-380,776,-392,772,-392,772,-388,776,-392,772,-392,772,-388,772,-392,772,-392,772,-392,772,-388,776,-392,772,-776,384,-392,772,-776,388,-388,772,-392,772,-776,388,-776,384,-392,772,-392,772,-392,772,-776,384,-392,772};
            } else if (x == FanDirection::REVERSE) {
              return {404,-380,780,-392,772,-388,776,-388,772,-392,772,-392,772,-392,772,-388,776,-388,772,-392,776,-388,772,-392,772,-780,384,-388,776,-776,384,-392,772,-392,772,-776,384,-780,384,-388,776,-388,776,-388,776,-776,384,-776,388};
            } else {
              return {};
            }
    on_preset_set:
      - remote_transmitter.transmit_raw:
          transmitter_id: tx_304
          repeat:
            times: 10
            wait_time: 10ms
          code: !lambda |-
            if (x == "Normal") {
              auto call = id(loft_fan).turn_on();
              call.set_speed(id(loft_fan).speed);
              call.perform();
              return {};
            } else if (x == "Natural Breeze") {
              return {400,-384,776,-388,772,-392,772,-388,776,-392,772,-392,768,-392,776,-392,772,-392,772,-388,772,-392,772,-392,772,-776,388,-388,772,-780,384,-392,772,-392,768,-396,772,-776,384,-776,388,-776,384,-392,772,-776,384,-392,772};
            } else if (x == "Sleep Timer 1 Hr") {
              return {404,-380,780,-388,772,-392,772,-392,776,-388,776,-388,776,-388,772,-392,772,-392,772,-392,776,-392,772,-388,776,-772,388,-388,776,-776,388,-388,776,-388,772,-396,772,-776,384,-392,776,-388,772,-392,772,-392,772,-780,384};
            } else if (x == "Sleep Timer 3 Hr") {
              return {404,-380,780,-388,776,-388,776,-388,776,-384,776,-392,772,-392,772,-392,772,-392,772,-392,772,-392,772,-392,772,-776,384,-392,772,-780,384,-388,776,-388,776,-388,776,-776,384,-392,776,-388,772,-392,772,-780,384,-388,772};
            } else if (x == "Sleep Timer 6 Hr") {
              return {400,-384,776,-392,772,-392,772,-388,776,-388,776,-384,776,-392,772,-392,772,-392,776,-388,772,-392,772,-392,776,-776,384,-388,776,-776,384,-388,776,-392,772,-392,772,-776,384,-392,776,-392,768,-396,772,-776,384,-776,388};
            } else if (x == "Home Away") {
              return {408,-376,780,-388,772,-392,772,-392,772,-392,772,-396,768,-392,772,-392,772,-392,772,-388,776,-388,776,-388,772,-780,384,-388,772,-780,384,-392,772,-392,772,-776,388,-776,384,-388,776,-388,776,-776,384,-388,776,-388,776};
            } else if (x == "Safe Exit") {
              return {404,-380,780,-388,776,-388,772,-392,772,-392,772,-392,772,-392,768,-396,772,-388,772,-392,772,-392,772,-388,776,-776,384,-392,772,-780,384,-388,772,-392,776,-776,384,-776,388,-388,772,-392,776,-776,384,-388,776,-780,380};
            } else {
              return {};
            }
    on_speed_set:
      - remote_transmitter.transmit_raw:
          transmitter_id: tx_304
          repeat:
            times: 10
            wait_time: 10ms
          code: !lambda |-
            switch (x) {
            case 1: return {408,-380,776,-392,772,-392,772,-388,776,-392,772,-388,776,-388,772,-392,772,-392,772,-392,772,-392,772,-392,772,-776,388,-388,772,-780,384,-388,772,-392,776,-388,776,-388,772,-392,772,-392,772,-388,772,-392,776,-776,384};
            case 2: return {400,-384,776,-388,776,-388,776,-392,772,-388,776,-388,772,-392,776,-388,772,-392,776,-384,776,-392,772,-392,772,-780,384,-388,772,-780,384,-392,772,-388,776,-392,772,-388,776,-388,776,-388,772,-396,768,-780,384,-776,388};
            case 3: return {392,-388,776,-388,776,-388,776,-388,772,-392,772,-392,772,-392,772,-392,772,-388,776,-388,776,-392,772,-388,776,-776,384,-392,776,-776,384,-392,772,-392,768,-396,772,-392,772,-388,772,-392,776,-776,384,-392,772,-780,384};
            case 4: return {356,-424,740,-424,740,-420,740,-424,744,-420,744,-416,744,-428,736,-424,744,-420,740,-420,744,-424,740,-432,732,-816,344,-436,728,-820,344,-416,748,-432,732,-428,736,-432,732,-428,736,-428,736,-816,344,-816,344,-832,336};
            case 5: return {412,-380,784,-376,788,-380,784,-380,784,-372,792,-376,784,-384,784,-376,788,-376,784,-384,784,-376,788,-376,788,-768,392,-376,788,-768,392,-384,784,-376,788,-376,788,-380,784,-376,788,-764,396,-384,780,-380,784,-768,396};
            case 6: return {412,-380,784,-380,784,-376,788,-380,784,-376,788,-380,784,-380,784,-376,788,-380,784,-380,784,-376,788,-380,784,-764,400,-376,788,-768,392,-376,788,-380,784,-380,784,-376,788,-380,784,-764,400,-376,788,-760,400,-768,396};
            case 7: return {412,-376,788,-380,780,-384,784,-376,788,-380,784,-380,784,-376,788,-380,784,-376,788,-380,784,-380,784,-376,788,-768,396,-380,784,-764,400,-380,780,-384,780,-380,788,-380,780,-384,784,-764,400,-768,392,-380,784,-768,396};
            case 8: return {416,-376,784,-384,780,-376,788,-380,784,-384,780,-380,784,-384,780,-380,784,-380,784,-384,780,-376,792,-376,784,-768,396,-380,784,-772,392,-376,788,-380,784,-380,784,-376,788,-384,780,-764,400,-768,392,-768,396,-772,388};
            case 9: return {408,-376,788,-384,780,-384,780,-380,784,-384,780,-380,784,-384,780,-384,784,-376,788,-380,780,-384,784,-376,788,-768,392,-380,788,-768,392,-380,784,-380,784,-384,784,-376,788,-768,392,-380,788,-376,784,-384,780,-768,396};
            case 10: return {412,-380,780,-384,780,-384,784,-376,784,-388,780,-380,784,-380,784,-384,780,-380,780,-388,780,-380,784,-384,780,-768,392,-384,784,-764,400,-380,780,-384,784,-376,784,-384,780,-768,396,-384,780,-384,784,-768,392,-772,392};
            case 11: return {412,-376,780,-392,772,-392,772,-392,772,-392,772,-392,772,-392,772,-392,772,-392,772,-392,772,-396,772,-388,776,-780,384,-388,776,-776,384,-392,772,-392,776,-388,776,-388,776,-776,384,-392,776,-776,384,-392,772,-780,388};
            case 12: return {412,-376,780,-392,772,-392,772,-392,776,-388,776,-392,772,-388,776,-388,776,-392,772,-392,772,-392,772,-392,772,-776,388,-392,772,-776,388,-388,776,-392,772,-392,772,-392,772,-780,384,-392,772,-776,388,-776,388,-776,384};
            case 13: return {408,-380,776,-392,776,-388,776,-392,772,-388,776,-392,772,-392,772,-392,772,-392,772,-392,776,-388,776,-388,776,-776,388,-388,776,-776,388,-388,772,-392,776,-388,776,-392,772,-780,384,-776,388,-388,776,-388,776,-780,384};
            case 14: return {412,-376,780,-392,772,-392,772,-392,776,-388,776,-392,772,-388,776,-392,772,-392,772,-392,772,-392,776,-392,772,-776,388,-388,776,-776,384,-392,776,-388,776,-392,772,-392,772,-776,388,-776,388,-388,776,-776,388,-776,388};
            case 15: return {412,-380,776,-392,772,-392,772,-392,772,-392,776,-392,772,-388,776,-392,772,-392,772,-392,772,-392,772,-392,772,-780,384,-388,776,-780,384,-392,772,-392,772,-392,772,-392,772,-780,384,-780,384,-776,388,-388,776,-776,388};
            case 16: return {412,-376,780,-388,776,-392,772,-392,772,-392,772,-392,772,-392,776,-388,776,-388,776,-392,772,-392,772,-392,772,-780,384,-392,772,-780,384,-392,772,-392,772,-392,772,-392,776,-776,388,-776,384,-780,384,-780,388,-776,384};
            default: return {};
            }

# Emerson SW405 ?, ?, ?, ?, ? (Nursery)
  - platform: template
    name: "Nursery Fan"
    id: nursery_fan
    has_direction: False
    has_oscillating: False
    speed_count: 4
    preset_modes:
      - Normal
      - Natural Breeze
      #- Sleep Timer 1 Hr
      #- Sleep Timer 3 Hr
      #- Sleep Timer 6 Hr
      #- Home Away
      #- Safe Exit
    on_turn_on:
      # set the last used speed
      - fan.turn_on:
          id: nursery_fan
          speed: !lambda return id(nursery_fan).speed;
    on_turn_off:
      - remote_transmitter.transmit_raw:
          transmitter_id: tx_304
          repeat:
            times: 8
            wait_time: 10ms
          code: [312,-336,612,-656,296,-332,620,-652,292,-664,284,-348,600,-664,288,-664,284,-660,288,-668,284,-344,608,-664,280]
    on_preset_set:
      - remote_transmitter.transmit_raw:
          transmitter_id: tx_304
          repeat:
            times: 10
            wait_time: 10ms
          code: !lambda |-
            if (x == "Normal") {
              auto call = id(nursery_fan).turn_on();
              call.set_speed(id(nursery_fan).speed);
              call.perform();
              return {};
            } else if (x == "Natural Breeze") {
              return {};
            } else {
              return {};
            }
    on_speed_set:
      - remote_transmitter.transmit_raw:
          transmitter_id: tx_304
          repeat:
            times: 7
            wait_time: 10ms
          code: !lambda |-
            switch (x) {
            case 1: return {324,-328,640,-656,320,-328,640,-660,308,-660,308,-340,632,-660,308,-664,304,-340,632,-660,312,-656,312,-656,312};
            case 2: return {332,-332,640,-664,312,-336,636,-660,316,-660,312,-340,636,-652,316,-340,632,-664,308,-664,312,-656,316,-656,316};
            case 3: return {332,-340,632,-660,320,-336,636,-668,308,-660,316,-332,644,-656,316,-336,636,-336,640,-660,312,-660,312,-656,320};
            case 4: return {304,-336,604,-664,284,-348,596,-664,284,-664,284,-352,596,-348,600,-660,284,-660,284,-664,284,-664,284,-660,284};
            default: return {};
            }